# --- ZONA DE PELIGRO: LIMPIEZA DE BASE DE DATOS ---
@app.get("/sistema/reset-fabrica")
def reset_base_de_datos(request: Request, db: Session = Depends(get_db)):
    # 1. Seguridad: Solo si estás logueado
    if not request.session.get("usuario"): 
        return RedirectResponse("/login", status_code=303)
    
    try:
        # 2. BORRADO EN CASCADA MANUAL (Orden Importante)
        
        # A. Primero borramos los Activos (porque dependen de todo lo demás)
        num_activos = db.query(models.ActivoTec).delete()
        
        # B. Luego borramos Modelos y Empleados (porque dependen de Marcas y Áreas)
        num_modelos = db.query(models.Modelo).delete()
        num_empleados = db.query(models.Empleado).delete()
        
        # C. Finalmente borramos los Maestros (Marcas, Tipos, Áreas)
        num_marcas = db.query(models.Marca).delete()
        num_tipos = db.query(models.TipoEquipo).delete()
        num_areas = db.query(models.Area).delete()
        
        # D. Confirmar cambios
        db.commit()
        
        mensaje = f"Limpieza completada: {num_activos} Activos, {num_modelos} Modelos, {num_empleados} Empleados eliminados. (Admin conservado)"
        print(f"♻️ {mensaje}")
        
        return RedirectResponse(f"/?msg={mensaje}&tipo=warning", status_code=303)
        
    except Exception as e:
        db.rollback()
        return RedirectResponse(f"/?msg=Error al limpiar: {str(e)}&tipo=danger", status_code=303)




sistema/reset-fabrica